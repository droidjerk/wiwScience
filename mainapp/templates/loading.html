{%- extends "base.html" %}

{% block content %}

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <div class="loader"></div>
    <script>
        function update_progress(status_url) {
            // send GET request to status URL
            $.getJSON(status_url, function(data) {
                if (data['state'] != 'PENDING' && data['state'] != 'PROGRESS') {
                        window.location.href = window.location.host + '/results';
                    }
                if data['state'] == 'FAILURE' {
                        window.location.href = window.location.host;
                    }
                else {
                    // rerun in 2 seconds
                    setTimeout(function() {
                        update_progress(status_url);
                    }, 1000);
                }
            });
        }
        update_progress(window.location.host + '/status/' + {{task}})
    </script>
{% endblock %}
